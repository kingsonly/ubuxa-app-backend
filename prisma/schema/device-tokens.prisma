model Device {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  serialNumber        String
  key                 String?
  startingCode        String?
  count               String?
  timeDivider         String?
  restrictedDigitMode Boolean @default(false)
  hardwareModel       String?
  firmwareVersion     String?

  tokens Tokens[]

  isTokenable Boolean @default(false)

  isUsed Boolean @default(false)

  saleItemIDs String[]   @db.ObjectId
  saleItems   SaleItem[] @relation(fields: [saleItemIDs], references: [id])

  inventoryId String   @db.ObjectId
  inventory   Inventory @relation(fields: [inventoryId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  storeId String @db.ObjectId
  store   Store  @relation(fields: [storeId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  // NEW: track agent custody per batch WITHOUT a new collection
  // shape: { [userTenantId: string]: { quantity: number, reserved: number } }
  agentCustodies Json? // default null -> treat as {}


  tenantId String @db.ObjectId
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([serialNumber, tenantId])
  @@map("devices")
}

model Tokens {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  token     String
  duration  String
  createdAt DateTime @default(now())
  tenantId  String   @db.ObjectId
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  device    Device?  @relation(fields: [deviceId], references: [id])
  deviceId  String?  @db.ObjectId
  storeId String @db.ObjectId
  store   Store  @relation(fields: [storeId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([token, tenantId])
  @@map("token")
}
